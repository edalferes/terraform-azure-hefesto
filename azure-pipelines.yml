# Starter pipeline
trigger:
- master
- develop

pool:
  vmImage: 'Ubuntu-16.04'

name: $(date:yyyyMMdd)$(rev:.r)
variables:
  imageName: terraform-test 

steps:
- script: |
    docker build -t $(imageName) .
  displayName: 'Build image docker'

- script: |
    docker run -e ARM_CLIENT_ID=$(spClientId) -e ARM_CLIENT_SECRET=$(spClientSecret) -e ARM_SUBSCRIPTION_ID=$(spSubscriptionId) -e ARM_TENANT_ID=$(spTenantId) $(imageName)
  env:
    ARM_CLIENT_ID: $(spClientId)
    ARM_CLIENT_SECRET: $(spClientSecret)
    ARM_SUBSCRIPTION_ID: $(spSubscriptionId)
    ARM_TENANT_ID: $(spTenantId)
  displayName: 'Run docker test'

- task: GitHubRelease@0
  #condition: eq(variables['Build.SourceBranch'], 'refs/heads/master')
  inputs:
    gitHubConnection: 'GitHub edalferes'
    repositoryName: 'edalferes/terraform-azure-recources'
    assets: |
         $(Build.ArtifactStagingDirectory)/README.md